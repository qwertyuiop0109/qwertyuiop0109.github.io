	server {

		include confstart.conf;

#---единая конфигурация для всех доменов на основном IP---------

                server_name     _;

		include apache_ip.conf;
		set $exploitprotect 1;
		set $proxy_port 8080;
		set $proxy_ssl_port 8443;
		set $domain_num 0; #порядковый номер правил/домена (обязательно уникальный)

		set $domain_uri $domain_num:$clickpageurl:$request_uri;
		set $domain_remote_addr $domain_num:$remote_addr;
#в разделе, указанном ниже настаиваются подключенные скрипты, общие для всех доменов кроме отдельно настроенных
#------------------------------настройка подключенных скриптов на странице---------------------------



if ($iphost) {
		set $proxy_ip 127.0.0.1;
		set $exploitprotect 1;
		set $proxy_port 8080;
		set $proxy_ssl_port 7443;
		set $domain_num 1; #порядковый номер правил/домена (обязательно уникальный)

		set $domain_uri $domain_num:$clickpageurl:$request_uri;
		set $domain_remote_addr $domain_num:$remote_addr;

#в разделе, указанном ниже настаиваются подключенные скрипты для этого домена (доменов)
#------------------------------настройка подключенных скриптов на странице---------------------------
}


#-----------------------------------------


                listen   443 ssl;
		listen   [::]:443 ipv6only=on ssl;

                listen   80;
		listen   [::]:80 ipv6only=on;



#	        ssl_certificate      /etc/httpd/conf/ssl.crt/server.crt;
#	        ssl_certificate_key  /etc/httpd/conf/ssl.key/server.key;
#заменил на сертификат для inteprice.com
#	        ssl_certificate      /var/www/httpd-cert/nginx_inteprice.com_bundle.crt;
#	        ssl_certificate_key  /var/www/httpd-cert/nginx_inteprice.com.key;
#заменил на автоматический сертификат для inteprice.com
#	        ssl_certificate      /root/lego/certificates/inteprice.com.crt;
#	        ssl_certificate_key  /root/lego/certificates/inteprice.com.key;
#заменил на более удобный автоматический сертификат для inteprice.com
	        ssl_certificate      /root/.acme.sh/inteprice.com/fullchain.cer;
	        ssl_certificate_key  /root/.acme.sh/inteprice.com/inteprice.com.key;




	        ssl_session_timeout  5m;
	        ssl_protocols  SSLv2 SSLv3 TLSv1;
	        ssl_ciphers  ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;
	        ssl_prefer_server_ciphers   on;

#------------------------------настройка подключенных скриптов на странице---------------------------

		if ($domain_uri ~* ^0:c:\/(files|stats|adv|ads|adjs|adview|adjsm)\/) {
			set $scritpsonpages 1;
		}


		if ($domain_uri ~* ^0:c:\/editor\/) {
			set $exploitprotect 0;
		}

#		if ($domain_uri ~* ^0:c:\/callhunter\/lib\/\?callback\=) {
		if ($domain_uri ~* ^0:c:\/callhunter\/lib\/) {
			set $exploitprotect 0;
		}


#-----------------------------------------

#индивидуальные белые адреса для отдельных доменов
#		if ($domain_remote_addr = '0:82.146.40.124') {
#			set $whitelistip 1;
#			set $exploitprotect 0;
#		}

#дополнительные общие белые адреса
#		if ( $remote_addr = 'xxx.xxx.xxx.xxx' ) {
#			set $whitelistip 1;
#			set $exploitprotect 0;
#		}

		include confend.conf;


	}




#настройка проксирования для отдельного входящего IP
#	server {
#		include confstart.conf;
#                server_name     _;
#                listen   xxx.xxx.xxx.xxx:443 ssl;
#                listen   xxx.xxx.xxx.xxx:80;
#		listen   [xxxx::xxxx]:443 ipv6only=on ssl;
#		listen   [xxxx::xxxx]:80 ipv6only=on;
#		set $proxy_ip yyy.yyy.yyy.yyy;
#		set $exploitprotect 1;
#		set $proxy_port 80;
#		set $proxy_ssl_port 443;
#	        ssl_certificate      /etc/httpd/conf/ssl.crt/server.crt;
#	        ssl_certificate_key  /etc/httpd/conf/ssl.key/server.key;
#	        ssl_session_timeout  5m;
#	        ssl_protocols  SSLv2 SSLv3 TLSv1;
#	        ssl_ciphers  ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;
#	        ssl_prefer_server_ciphers   on;
#------------------------------настройка подключенных скриптов на странице---------------------------
#		set $click_uri $clickpageurl:$request_uri;
#		if ($click_uri ~* ^c:\/(files|stats|adv|ads|adjs|adview|adjsm)\/) {
#			set $scritpsonpages 1;
#		}
#-----------------------------------------
#		if ( $remote_addr = $proxy_ip ) {
#			set $whitelistip 1;
#			set $exploitprotect 0;
#		}
#		if ( $remote_addr = $server_addr ) {
#			set $whitelistip 1;
#			set $exploitprotect 0;
#		}
#дополнительные белые адреса
#		if ( $remote_addr = 'xxx.xxx.xxx.xxx' ) {
#			set $whitelistip 1;
#			set $exploitprotect 0;
#		}
#		include confend.conf;
#	}

