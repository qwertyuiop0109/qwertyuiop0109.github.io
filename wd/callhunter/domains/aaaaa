(function(window, document) {
    // Приватные функции для работы с cookies
    const cookieManager = {
        set: function(name, value, days) {
            try {
                const date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                const expires = `; expires=${date.toUTCString()}`;
                document.cookie = `${encodeURIComponent(name)}=${encodeURIComponent(value)}${expires}; path=/; secure; samesite=strict`;
                return true;
            } catch (error) {
                console.error('Error setting cookie:', error);
                return false;
            }
        },
        
        get: function(name) {
            try {
                const nameEQ = encodeURIComponent(name) + '=';
                const cookies = document.cookie.split(';');
                
                for (let i = 0; i < cookies.length; i++) {
                    let cookie = cookies[i];
                    while (cookie.charAt(0) === ' ') {
                        cookie = cookie.substring(1, cookie.length);
                    }
                    if (cookie.indexOf(nameEQ) === 0) {
                        return decodeURIComponent(cookie.substring(nameEQ.length, cookie.length));
                    }
                }
                return null;
            } catch (error) {
                console.error('Error getting cookie:', error);
                return null;
            }
        }
    };

    // Приватная функция для очистки цены
    const cleanPriceString = function(priceText) {
        try {
            return priceText.replace(/[^0-9\.]/g, '');
        } catch (error) {
            console.error('Error cleaning price string:', error);
            return '';
        }
    };

    // Основная функция отслеживания цены
    const saveOrderPriceInCookie = function() {
        try {

            // XPath
            //const priceElement = document.evaluate('//*[@class="order-summary-b"]', document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;
            // JS Path
            const priceElement = document.querySelector("#cart > div.order-summary > div.order-summary-b");
            // Полный JS Path
            //const priceElement = window.document.querySelector("#some-id > div.order-summary-b");

            
            if (!priceElement) {
                return false;
            }

            const priceText = priceElement.textContent.trim();
            const price = cleanPriceString(priceText);
            
            if (!price) {
                return false;
            }

            const existingPrice = cookieManager.get('SSorderPrice');
            
            if (price !== existingPrice) {
                console.log(price)
                const ret = cookieManager.set('SSorderPrice', price, 7);
                console.log(document.cookie)
                return ret;
            }

            return true;
        } catch (error) {
            console.error('Error in saveOrderPriceInCookie:', error);
            return false;
        }
    };

    // Инициализация отслеживания цены
    const initPriceTracking = function() {
        try {
            // Первоначальное сохранение цены
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', saveOrderPriceInCookie);
            } else {
                saveOrderPriceInCookie();
            }

            // Настройка MutationObserver для отслеживания изменений
            const observer = new MutationObserver((mutations) => {
                // Добавляем debounce для предотвращения частых вызовов
                clearTimeout(window._priceUpdateTimeout);
                window._priceUpdateTimeout = setTimeout(saveOrderPriceInCookie, 300);
            });

            observer.observe(document.body, {
                childList: true,
                subtree: true,
                characterData: true
            });

            return true;
        } catch (error) {
            console.error('Error initializing price tracking:', error);
            return false;
        }
    };

    // Запуск отслеживания
    initPriceTracking();
})(window, document);


!function(){const e={set:(e,t,n)=>{try{const o=new Date;return o.setTime(o.getTime()+24*n*60*60*1e3),document.cookie=`${encodeURIComponent(e)}=${encodeURIComponent(t)}; expires=${o.toUTCString()}; path=/; secure; samesite=strict`,!0}catch(e){return console.error(e),!1}},get:e=>{try{const t=encodeURIComponent(e)+"=",n=document.cookie.split(";");for(let e=0;e<n.length;e++){let o=n[e];for(;" "===o.charAt(0);)o=o.substring(1);if(0===o.indexOf(t))return decodeURIComponent(o.substring(t.length))}return null}catch(e){return console.error(e),null}}},t=()=>{try{
// XPath
//const t = document.evaluate('//*[@class="order-summary-b"]', document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;
// JS Path
const t=document.querySelector("#cart > div.order-summary > div.order-summary-b");
// Полный JS Path
//const t = window.document.querySelector("#some-id > div.order-summary-b");
if(!t)return;
const n=t.textContent.trim().replace(/[^0-9\.]/g,"");
if(n){const t=e.get("SSorderPrice");n!==t&&e.set("SSorderPrice",n,7)}}catch(e){console.error(e)}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t):t(),new MutationObserver(()=>{clearTimeout(window._priceUpdateTimeout),window._priceUpdateTimeout=setTimeout(t,300)}).observe(document.body,{childList:!0,subtree:!0,characterData:!0})}(window, document);

console.log(document.cookie)


=========================================================================


(function(window, document) {

	window.IPclhrDataUpdate = {}
	window.IPclhrDataUpdate.AdwConvHit = {}
})(window, document);


(function(window, document) {
    'use strict';

    const COOKIE_NAME = 'SSorderPrice';
    const CONVERSION_DATA_KEY = 'AdwConvHit';
    // const CURRENCY_CODE = 'UAH'; // Можно закомментировать эту строку, если валюта не определена

    function getCookie(cookieName) {
        return document.cookie.split(`; ${cookieName}=`).pop()?.split(';')[0] ?? null;
    }

    function updateConversionData(conversionDataObject, currencyCode) {
        const cookieValue = getCookie(COOKIE_NAME);

        if (cookieValue) {
            conversionDataObject.google_conversion_value = cookieValue;

            if (currencyCode) {
                conversionDataObject.google_conversion_currency = currencyCode;
            }

//            console.log('Conversion values updated:', {
//                google_conversion_value: cookieValue,
//                google_conversion_currency: currencyCode || '(not updated)'
//            });

            return true;
        }

//        console.log(`${COOKIE_NAME} cookie not found or empty`);
        return false;
    }

    function initializeConversionTracking() {
        if (!window.IPclhrDataUpdate || !window.IPclhrDataUpdate[CONVERSION_DATA_KEY]) {
//            console.log('IPclhrDataUpdate.AdwConvHit not found');
            return;
        }

        const conversionData = window.IPclhrDataUpdate[CONVERSION_DATA_KEY];
        let currencyCode = typeof CURRENCY_CODE === 'string' ? CURRENCY_CODE.trim() : '';

//        if (updateConversionData(conversionData, currencyCode)) {
//            console.log('Conversion tracking initialized successfully');
//        }
        updateConversionData(conversionData, currencyCode)
    }

    initializeConversionTracking();

})(window, document);
